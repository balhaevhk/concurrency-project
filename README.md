# üí∏ Payment System ‚Äî –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ Go

### üöÄ –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö

---

## üìö –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é —ç–≤–æ–ª—é—Ü–∏—é –ø—Ä–æ—Å—Ç–æ–π –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã ‚Äî –æ—Ç –±–∞–∑–æ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç **data race**.

–¢—ã —É–≤–∏–¥–∏—à—å, –∫–∞–∫:

* —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –±–∞–ª–∞–Ω—Å–∞–º–∏
* –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **goroutine**, **channel**, **sync.WaitGroup** –∏ **sync.Mutex** –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üß† –≠—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –í–µ—Ä—Å–∏—è 1 ‚Äî –ë–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

> –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º.

* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `User` —Å –º–µ—Ç–æ–¥–∞–º–∏ `Deposit` –∏ `Withdraw`
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–Ω—è—Ç–∏–µ–º
* –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ (`*User`)
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü –≤ Go

---

### ‚úÖ –í–µ—Ä—Å–∏—è 2 ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

> –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Transaction` –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `PaymentSystem`

* –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
* –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ
* –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

### ‚úÖ –í–µ—Ä—Å–∏—è 3 ‚Äî –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

> –î–æ–±–∞–≤–ª–µ–Ω—ã **–≥–æ—Ä—Ç–∏–Ω—ã**, **–∫–∞–Ω–∞–ª—ã**, **sync.WaitGroup**

* –ó–∞–ø—É—Å–∫ 3 –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –ü—Ä–æ–±–ª–µ–º–∞: –≤–æ–∑–º–æ–∂–Ω—ã **data race** –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –±–∞–ª–∞–Ω—Å–∞–º

---

### ‚úÖ –í–µ—Ä—Å–∏—è 4 ‚Äî –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

> –î–æ–±–∞–≤–ª–µ–Ω—ã **sync.Mutex** –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `User`

* –ö–∞–∂–¥—ã–π `User` —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â—ë–Ω –º—å—é—Ç–µ–∫—Å–æ–º
* –ú–µ—Ç–æ–¥—ã `Deposit` –∏ `Withdraw` —Å—Ç–∞–ª–∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏
* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö –±–µ–∑ –≥–æ–Ω–æ–∫
* –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∞ –∫ real-world —Å–∏—Å—Ç–µ–º–∞–º

---

## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* Go `1.20+`
* `goroutine` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å
* `channel` ‚Äî –æ–±–º–µ–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
* `sync.WaitGroup` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–æ–≤
* `sync.Mutex` ‚Äî –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –≥–æ–Ω–∫–∏

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```go
type User struct {
    ID      string
    Name    string
    Balance float64
    mu      sync.Mutex
}

type Transaction struct {
    FromID string
    ToID   string
    Amount float64
}

type PaymentSystem struct {
    Users        map[string]*User
    Transactions []Transaction
}
```

---

## üîÅ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

1. –°–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏
2. –î–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–∞–Ω–∞–ª
4. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è 3 –≤–æ—Ä–∫–µ—Ä–∞-–≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ:

   * –ø–æ–ª—É—á–∞—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞
   * –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–Ω–∏–º–∞—é—Ç/–∑–∞—á–∏—Å–ª—è—é—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞
   * –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏
5. –ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
6. `sync.WaitGroup` –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

---

## ‚ñ∂Ô∏è –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
–°–æ–∑–¥–∞—é UserID: 1 —Å –±–∞–ª–∞–Ω—Å–æ–º 1000
–°–æ–∑–¥–∞—é UserID: 2 —Å –±–∞–ª–∞–Ω—Å–æ–º 500
–ü–µ—Ä–µ–≤–æ–∂—É —Å UserID: 1 –Ω–∞ UserID: 2 —Å—É–º–º—É –≤ —Ä–∞–∑–º–µ—Ä–µ 200
–ü–µ—Ä–µ–≤–æ–∂—É —Å UserID: 2 –Ω–∞ UserID: 1 —Å—É–º–º—É –≤ —Ä–∞–∑–º–µ—Ä–µ 50

–ò—Ç–æ–≥:
John's Balance: 850
Petr's Balance: 650
```

---

## üß™ –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–æ–∫

```bash
error withdrawing from user 1: insufficient funds on balance
error: user with ID '3' not found
```

---

## üìå –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
git clone https://github.com/balhaevhk/concurrency-project.git
cd concurrency-project
go run main.go
```

---

## ü§ñ –ß–µ–º –ø–æ–ª–µ–∑–µ–Ω —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç

* –£—á–∏—à—å—Å—è –ø–∏—Å–∞—Ç—å **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–¥**
* –û—Å–≤–∞–∏–≤–∞–µ—à—å **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Go**
* –ü–æ–Ω–∏–º–∞–µ—à—å **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º**
* –†–∞–±–æ—Ç–∞–µ—à—å —Å **–≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏, –∫–∞–Ω–∞–ª–∞–º–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π**
* –ì–æ—Ç–æ–≤–∏—à—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –ø–æ–¥ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ, –∏–≥—Ä–æ–≤—ã–µ, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ)

---
