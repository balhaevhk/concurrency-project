# üí∏ Payment System ‚Äî –í–µ—Ä—Å–∏—è 4

> ‚öôÔ∏è –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –Ω–∞ Go
> üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `sync.Mutex` –¥–ª—è –∑–∞—â–∏—Ç—ã –±–∞–ª–∞–Ω—Å–∞
> üßµ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å –ø–æ–º–æ—â—å—é `goroutine`, `chan`, `sync.WaitGroup`

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–∞ –≤–µ—Ä—Å–∏—è –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã **—Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É data race**, –∫–æ—Ç–æ—Ä–∞—è –º–æ–≥–ª–∞ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`User`) —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `sync.Mutex`, –∫–æ—Ç–æ—Ä—ã–π **–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–∞–ª–∞–Ω—Å—É** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–æ—Ä—É—Ç–∏–Ω.

---

## üß† –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞–ª–∞–Ω—Å–æ–º
* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
* **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º—å—é—Ç–µ–∫—Å–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `User`**
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ (`chan`) –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–º–æ—â—å—é —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤ (3 –≥–æ—Ä—É—Ç–∏–Ω—ã)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### `User`

```go
type User struct {
	ID      string
	Name    string
	Balance float64
	mu      sync.Mutex
}
```

> –ë–∞–ª–∞–Ω—Å –∑–∞—â–∏—â—ë–Ω –º—å—é—Ç–µ–∫—Å–æ–º `mu`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö `Deposit` –∏ `Withdraw`.

---

### `Transaction`

```go
type Transaction struct {
	FromID string
	ToID   string
	Amount float64
}
```

---

### `PaymentSystem`

```go
type PaymentSystem struct {
	Users        map[string]*User
	Transactions []Transaction
}
```

---

## üîÅ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. –°–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏.
2. –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –Ω–∏–º–∏.
3. –°–æ–∑–¥–∞—ë—Ç—Å—è –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª `chan Transaction`, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
4. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è **3 –≤–æ—Ä–∫–µ—Ä–∞** (–≥–æ—Ä—É—Ç–∏–Ω—ã), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö:

   * –ü–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏–∑ –∫–∞–Ω–∞–ª–∞
   * –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ —Å–Ω–∏–º–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (`Withdraw`)
   * –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—é (`Deposit`)
   * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤)
5. –ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∏ `sync.WaitGroup` –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤.

---

## ‚ñ∂Ô∏è –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
–°–æ–∑–¥–∞—é UserID: 1 —Å –±–∞–ª–∞–Ω—Å–æ–º 1000
–°–æ–∑–¥–∞—é UserID: 2 —Å –±–∞–ª–∞–Ω—Å–æ–º 500
–ü–µ—Ä–µ–≤–æ–∂—É —Å UserID: 1 –Ω–∞ UserID: 2 —Å—É–º–º—É –≤ —Ä–∞–∑–º–µ—Ä–µ 200
–ü–µ—Ä–µ–≤–æ–∂—É —Å UserID: 2 –Ω–∞ UserID: 1 —Å—É–º–º—É –≤ —Ä–∞–∑–º–µ—Ä–µ 50
–ò—Ç–æ–≥–æ
John's Balance: 850
Petr's Balance: 650
–£ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è 850
–£ –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è 650
```

---

## üìå –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* Go 1.20+
* `sync.Mutex` ‚Äî –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –≥–æ–Ω–∫–∏
* `sync.WaitGroup` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
* `goroutine` ‚Äî –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
* `channel` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
go run main.go
```

---

## ü§ñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

> üî¨ –≠—Ç–∞ –≤–µ—Ä—Å–∏—è –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:
>
> * –ö–∞–∫ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º** –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
> * –ö–∞–∫ **–∏–∑–±–µ–≥–∞—Ç—å data race** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞–ª–∞–Ω—Å–∞)
> * –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sync.Mutex` **–Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–±—ä–µ–∫—Ç–∞**, –∞ –Ω–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
